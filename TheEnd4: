<!DOCTYPE html>
<html lang="en" data-theme="auto">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RetroFS</title>
  <style>
    /* === THEME === */
    :root { --bg: #f8f8f8; --fg: #000; --accent: #000; --card-bg: #fff; --border: #000; }
    @media (prefers-color-scheme: dark) {
      :root { --bg: #0d0d0d; --fg: #fff; --accent: #fff; --card-bg: #1a1a1a; --border: #444; }
    }
    [data-theme="dark"] { --bg: #0d0d0d; --fg: #fff; --accent: #fff; --card-bg: #1a1a1a; --border: #444; }
    [data-theme="light"] { --bg: #f8f8f8; --fg: #000; --accent: #000; --card-bg: #fff; --border: #000; }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg); color: var(--fg); font-family: 'Courier New', monospace;
      padding: 1.5rem; line-height: 1.6; transition: background 0.4s, color 0.4s;
    }
    h1 { font-size: 2rem; text-align: center; margin: 1rem 0 2rem; letter-spacing: 2px; }
    .container { max-width: 800px; margin: 0 auto; }

    /* === CARDS === */
    .card {
      background: var(--card-bg); border: 3px solid var(--border); border-radius: 12px;
      padding: 1.2rem; margin-bottom: 1.5rem; position: relative; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.8rem; }
    .card-title { font-weight: bold; font-size: 1.1rem; }
    .status { font-weight: bold; }
    .online { color: #0a0; }
    .offline { color: #a00; }
    .locked { color: #aa0; }

    /* === FILE BROWSER === */
    .file-list { list-style: none; }
    .file-item {
      padding: 0.6rem 0; border-bottom: 1px dashed var(--border); display: flex; justify-content: space-between;
      cursor: pointer; transition: background 0.2s;
    }
    .file-item:hover { background: rgba(255,255,255,0.1); }
    .file-name { font-family: monospace; }
    .file-size { font-size: 0.8rem; opacity: 0.7; }

    /* === ANIMATIONS === */
    .loader {
      width: 70px; height: 70px; opacity: 0; transition: opacity 0.3s ease; margin: 0.5rem 0;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.2));
    }
    .trigger:checked ~ .loader { opacity: 1; }
    .trigger:checked ~ .loader svg * { animation-play-state: running; }
    .loader svg * { animation-play-state: paused; stroke: var(--accent); fill: var(--accent); }
    svg { width: 100%; height: 100%; }
    .stroke { stroke: var(--accent); fill: none; stroke-width: 2.8; }
    .fill { fill: var(--accent); }

    /* === CONTROLS === */
    .controls { text-align: center; margin: 2rem 0; }
    label {
      display: inline-block; padding: 0.6rem 1.2rem; background: var(--accent); color: var(--bg);
      border-radius: 8px; cursor: pointer; font-size: 0.9rem; margin: 0 0.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: transform 0.2s;
    }
    label:hover { transform: translateY(-2px); }
    .trigger { display: none; }

    /* === STATUS BAR === */
    .status-bar {
      position: fixed; bottom: 0; left: 0; right: 0; background: var(--card-bg);
      border-top: 2px solid var(--border); padding: 0.8rem; font-size: 0.8rem; text-align: center;
      opacity: 0.9;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>RETROFS</h1>

    <!-- === THEME TOGGLE === -->
    <div class="controls">
      <input type="checkbox" id="theme" class="trigger">
      <label for="theme" id="theme-label">Dark Mode</label>
    </div>

    <!-- === STATUS CARDS === -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">Core Engine</div>
        <div class="status online" id="core-status">● Online</div>
      </div>
      <div class="loader" id="gears-loader">
        <input type="checkbox" id="gears" class="trigger">
        <svg viewBox="0 0 100 100" aria-label="Processing...">
          <path class="gear1 stroke" d="M50 15 L55 20 L60 15 L58 25 L63 30 L55 32 L50 35 L45 32 L37 30 L42 25 L40 15 L45 20 Z">
            <animateTransform attributeName="transform" type="rotate" from="0 50 28" to="360 50 28" dur="2.5s" repeatCount="indefinite"/>
          </path>
          <path class="gear2 stroke" d="M50 65 L55 60 L60 65 L58 55 L63 50 L55 48 L50 45 L45 48 L37 50 L42 55 L40 65 L45 60 Z">
            <animateTransform attributeName="transform" type="rotate" from="360 50 72" to="0 50 72" dur="2.5s" repeatCount="indefinite"/>
          </path>
          <circle cx="50" cy="50" r="4" class="fill"/>
          <audio id="gears-snare"><source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQg0="></audio>
          <audio id="gears-grind" loop><source src="data:audio/wav;base64,UklGRiQCAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YQAGaGhoaWppaWlqaWtra2tsbGxtbW1tbW5ubm9vcHBvcXJxdHV1dXZ2dnd3d3h4eHl5eXp6e3t8fX19fn5+f39/gICBgYGBgoKDg4OEhYaHiImKi4yNjY2Oj5CRkpOUlZaXmJmam5ydnp+goaKjo6OkpKSlpqeoqaqrrK2ur7CxtLG0sbSztrO3t7i5uru8vb2+vsDBwsPExcbHyMrLzM3Oz9DR0tPU1dbX2Nna2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/g=="></audio>
          <set href="#gears-snare" attributeName="autoplay" to="true" begin="0s"/>
          <set href="#gears-grind" attributeName="autoplay" to="true" begin="0.1s"/>
        </svg>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-title">Sync Pipeline</div>
        <div class="status online" id="sync-status">● Online</div>
      </div>
      <div class="loader" id="tube-loader">
        <input type="checkbox" id="tube" class="trigger">
        <svg viewBox="0 0 120 60" aria-label="Transferring...">
          <defs><path id="tube-path" d="M15,30 Q40,15 60,30 T105,30" class="stroke"/></defs>
          <use href="#tube-path" opacity="0.25"/>
          <circle r="7" class="fill">
            <animateMotion dur="1.8s" repeatCount="indefinite" rotate="auto">
              <mpath href="#tube-path"/>
            </animateMotion>
          </circle>
          <circle cx="15" cy="30" r="4" class="fill"/>
          <circle cx="105" cy="30" r="4" class="fill"/>
          <audio id="tube-whoosh"><source src="data:audio/wav;base64,UklGRhwBAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YQAGQEBAP0BAQD9AQEBBQEBAQUBAQEFBQUFBQUFCQUFDQUFDQUFEQUFFQUFGQUFHQUFHgUGBgYGBgYKCgoODg4PEhYSFhImKi4yNjY2Oj5CRkpOUlZaXmJmam5ydnp+goaKjo6OkpKSlpqeoqaqrrK2ur7CxtLG0sbSztrO3t7i5uru8vb2+vsDBwsPExcbHyMrLzM3Oz9DR0tPU1dbX2Nna2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/g=="></audio>
          <audio id="tube-squeak"><source src="data:audio/wav;base64,UklGRiACAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YQAGg4ODhISEhYaHiImKi4yNjY2Oj5CRkpOUlZaXmJmam5ydnp+goaKjo6OkpKSlpqeoqaqrrK2ur7CxtLG0sbSztrO3t7i5uru8vb2+vsDBwsPExcbHyMrLzM3Oz9DR0tPU1dbX2Nna2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/g=="></audio>
          <set href="#tube-whoosh" attributeName="autoplay" to="true" begin="0s"/>
          <set href="#tube-squeak" attributeName="autoplay" to="true" begin="1.6s"/>
        </svg>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-title">Secure Vault</div>
        <div class="status locked" id="vault-status">● Locked</div>
      </div>
      <div class="loader" id="vault-loader">
        <input type="checkbox" id="vault" class="trigger">
        <svg viewBox="0 0 80 80" aria-label="Opening vault...">
          <g class="vault-door">
            <rect x="15" y="10" width="50" height="60" rx="3" class="stroke" stroke-width="4"/>
            <circle cx="55" cy="40" r="9" class="stroke" stroke-width="3"/>
            <line x1="55" y1="31" x2="55" y2="49" class="stroke" stroke-width="2.5"/>
            <line x1="46" y1="40" x2="64" y2="40" class="stroke" stroke-width="2.5"/>
          </g>
          <audio id="vault-spin"><source src="data:audio/wav;base64,UklGRiQCAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YQAGg4ODhISEhYaHiImKi4yNjY2Oj5CRkpOUlZaXmJmam5ydnp+goaKjo6OkpKSlpqeoqaqrrK2ur7CxtLG0sbSztrO3t7i5uru8vb2+vsDBwsPExcbHyMrLzM3Oz9DR0tPU1dbX2Nna2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/g=="></audio>
          <audio id="vault-creak"><source src="data:audio/wav;base64,UklGRjQBAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YQAGg4ODg4OEhYaHiImKi4yNjY2Oj5CRkpOUlZaXmJmam5ydnp+goaKjo6OkpKSlpqeoqaqrrK2ur7CxtLG0sbSztrO3t7i5uru8vb2+vsDBwsPExcbHyMrLzM3Oz9DR0tPU1dbX2Nna2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/g=="></audio>
          <audio id="vault-clunk"><source src="data:audio/wav;base64,UklGRhwBAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YQAGQEBAP0BAQD9AQEBBQEBAQUBAQEFBQUFBQUFCQUFDQUFDQUFEQUFFQUFGQUFHQUFHgUGBgYGBgYKCgoODg4PEhYSFhImKi4yNjY2Oj5CRkpOUlZaXmJmam5ydnp+goaKjo6OkpKSlpqeoqaqrrK2ur7CxtLG0sbSztrO3t7i5uru8vb2+vsDBwsPExcbHyMrLzM3Oz9DR0tPU1dbX2Nna2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/g=="></audio>
          <animateTransform href=".vault-door" attributeName="transform" type="rotate"
                            from="0 18 40" to="-92 18 40" dur="1.9s" begin="0.5s" fill="freeze"/>
          <set href="#vault-spin" attributeName="autoplay" to="true" begin="0s"/>
          <set href="#vault-creak" attributeName="autoplay" to="true" begin="0.5s"/>
          <set href="#vault-clunk" attributeName="autoplay" to="true" begin="1.9s"/>
        </svg>
      </div>
    </div>

    <!-- === FILE BROWSER === -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">Files</div>
        <div><small id="path-display">/storage/emulated/0</small></div>
      </div>
      <ul class="file-list" id="file-list">
        <li class="file-item"><span class="file-name">..</span></li>
        <li class="file-item"><span class="file-name">Documents</span><span class="file-size">Folder</span></li>
        <li class="file-item"><span class="file-name">backup.tar.gz</span><span class="file-size">2.1 MB</span></li>
      </ul>
    </div>

    <!-- === STATUS BAR === -->
    <div class="status-bar">
      <span id="clock"></span> | 
      <span id="watchdog-status">Watchdog: Active</span>
    </div>
  </div>

  <!-- === PYTHON BRIDGE: Update UI from File === -->
  <script>
    // NO JS IN CORE — but tiny bridge to read /tmp/retrofs.json
    setInterval(() => {
      fetch('/tmp/retrofs.json?' + Date.now())
        .then(r => r.json())
        .then(data => {
          if (data.core === false) document.getElementById('core-status').classList.replace('online', 'offline');
          if (data.sync === false) document.getElementById('sync-status').classList.replace('online', 'offline');
          if (data.vault === 'open') document.getElementById('vault-status').textContent = '● Open';
          document.getElementById('clock').textContent = new Date().toLocaleTimeString();
        })
        .catch(() => {});
    }, 1000);
  </script>
</body>
</html>